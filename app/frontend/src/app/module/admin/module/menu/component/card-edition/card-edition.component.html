<div 
    *ngIf="dishChoices$ | async as dishChoices"
    class="card-edition flexColumn"
    cdkDropList
    >
    <div
        *ngFor="let category of categories$ | async"
        class="card-edition--category"
        cdkDrag
    >
        <mat-form-field class="width-100-p">
            <mat-label>{{'CATEGORY.NAME' | translate}}</mat-label>
            <input matInput [(ngModel)]="category.name" type="text"/>
        </mat-form-field>
        <div
            *ngFor="let categoryElement of category.elements"
            class="card-edition--category-element"
        >
            <div class="card-edition--category-element-form">
                <div class="card-edition--category-element-form-inputs">
                    <mat-form-field>
                        <mat-label>{{'CATEGORY_ELEMENT.NAME' | translate}}</mat-label>
                        <input matInput [(ngModel)]="categoryElement.name" type="text"/>
                    </mat-form-field>
                    <mat-form-field>
                        <mat-label>{{'CATEGORY_DESCRIPTION.NAME' | translate}}</mat-label>
                        <input matInput [(ngModel)]="categoryElement.description" type="text"/>
                    </mat-form-field>
                </div>
                <div
                    *ngFor="let dishElement of categoryElement.elements"
                    class="card-edition--dish-element-form"
                >
                    <mat-form-field>
                        <mat-label>{{'DISH_ELEMENT.NAME' | translate}}</mat-label>
                        <input matInput [(ngModel)]="dishElement.name" type="text"/>
                    </mat-form-field>
                    <mat-form-field>
                        <mat-select [(ngModel)]="dishElement.food">
                            <mat-option *ngFor="let food of dishChoices" [value]="food.id === dishElement.food.id ? dishElement.food : food">{{food.name}}</mat-option>
                        </mat-select>
                    </mat-form-field>
                </div>
                <div
                    *ngFor="let formula of categoryElement.formulas"
                    class="card-edition--formula-form"
                >
                    <div>
                        <mat-form-field>
                            <mat-label>{{'FORMULA.DESCRIPTION' | translate}}</mat-label>
                            <input matInput [(ngModel)]="formula.description" type="text"/>
                        </mat-form-field>
                        <mat-form-field>
                            <mat-label>{{'FORMULA.PRICE' | translate}}</mat-label>
                            <input matInput [(ngModel)]="formula.price" type="number"/>
                        </mat-form-field>
                    </div>
                    <div
                        *ngFor="let formulaEl of formula.elements"
                        class="card-edition--form-formula-elements"
                    >
                        <mat-form-field>
                            <mat-label>{{'FORMULA_ELEMENT.QUANTITY' | translate}}</mat-label>
                            <input matInput [(ngModel)]="formulaEl.quantity" type="number"/>
                        </mat-form-field>
                        <mat-form-field>
                            <mat-select [(ngModel)]="formulaEl.dishElementId">
                                <mat-option *ngFor="let dishEl of categoryElement.elements" [value]="dishEl.id">{{dishEl.name}}</mat-option>
                            </mat-select>
                        </mat-form-field>
                    </div>
                </div>
            </div>

            <div
                class="card-edition--category-element-preview"
            >
                <app-category-element-display
                    [categoryElement]="categoryElement"
                    [category]="category"
                    class="card-edition--category-element-preview-content"
                    ></app-category-element-display>
                <app-formulas-explanation
                    [categoryElement]="categoryElement"
                ></app-formulas-explanation>
            </div>
        </div>
    </div>
</div>
